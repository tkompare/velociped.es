$(document).ready(function(){var b={mDOM:document.getElementById("theMap"),mCtr:new google.maps.LatLng("41.845","-87.669"),mOpt:{zoom:11,mapTypeControl:true,mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:false,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP}},pDURL:"http://data.cityofchicago.org/api/views/ktq5-qe3d/rows.json?jsonp=?",pMkrs:Array(),pInf:Array(),pD:null,wLyr:null,wTID:"3057562",wCol:"geometry",addr:false,gcodr:new google.maps.Geocoder(),aMkr:false,cwSD:false,cwSts:{},commas:function(c){c+="";subStr=c.split(".");subStr1=subStr[0];subStr2=subStr.length>1?"."+subStr[1]:"";regx=/(\d+)(\d{3})/;while(regx.test(subStr1)){subStr1=subStr1.replace(regx,"$1,$2")}return subStr1+subStr2},oIBx:function(e,c,d){return function(){d.open(e,c)}},cIBx:function(e,c,d){return function(){d.close(e,c)}},pDH:function(d){if(d==null){isAddrSearch=true;markerLat=b.aMkr.getPosition().lat();markerLng=b.aMkr.getPosition().lng()}else{isAddrSearch=false;b.pD=d}numRows=parseInt(b.pD.data.length);potholeLatLng=Array();b.pMkrs=Array();potholeText=Array();b.pInf=Array();numShown=0;phDates=new Array();for(var c=1;c<numRows;c++){if(isAddrSearch==false||(isAddrSearch==true&&b.pD.data[c][13][1]!=null&&b.pD.data[c][13][2]!=null&&((b.pD.data[c][13][1]<(markerLat+0.0076))&&(b.pD.data[c][13][1]>(markerLat-0.0076))&&(b.pD.data[c][13][2]<(markerLng+0.0098))&&(b.pD.data[c][13][2]>(markerLng-0.0098))))){phDates[numShown]=new XDate(b.pD.data[c][8]);numShown++}}b.doStats(phDates);for(var c=1;c<numRows;c++){if(isAddrSearch==false||(isAddrSearch==true&&b.pD.data[c][13][1]!=null&&b.pD.data[c][13][2]!=null&&((b.pD.data[c][13][1]<(markerLat+0.0076))&&(b.pD.data[c][13][1]>(markerLat-0.0076))&&(b.pD.data[c][13][2]<(markerLng+0.0098))&&(b.pD.data[c][13][2]>(markerLng-0.0098))))){date=b.pD.data[c][8].replace("T00:00:00","");today=new XDate();thisDate=new XDate(b.pD.data[c][8]);thisDateDiff=thisDate.diffDays(today);if(thisDateDiff<b.cwSts.mean){theIcon="img/l.png"}else{if(thisDateDiff>=b.cwSts.mean&&thisDateDiff<=b.cwSts.mstd){theIcon="img/b.png"}else{theIcon="img/d.png"}}potholeLatLng[c]=new google.maps.LatLng(b.pD.data[c][13][1],b.pD.data[c][13][2]);b.pMkrs[c]=new google.maps.Marker({position:potholeLatLng[c],map:a,icon:theIcon});potholeText[c]='<div class="infoBox" style="border:1px solid rgb(0,0,0); margin-top:8px; background:rgb(255,207,207); padding:5px; font-size:80%;">'+b.pD.data[c][12]+"<br />Ticket: "+b.pD.data[c][11]+"<br />Created: "+date+"<br /></div>";pInfBoxOptions={content:potholeText[c],disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{background:"url('img/tipbox.gif') no-repeat",opacity:0.95,width:"160px"},closeBoxMargin:"10px 2px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};b.pInf[c]=new InfoBox(pInfBoxOptions);google.maps.event.addListener(b.pMkrs[c],"mouseover",b.oIBx(a,b.pMkrs[c],b.pInf[c]));google.maps.event.addListener(b.pMkrs[c],"click",b.oIBx(a,b.pMkrs[c],b.pInf[c]));google.maps.event.addListener(b.pMkrs[c],"mouseout",b.cIBx(a,b.pMkrs[c],b.pInf[c]))}}},doStats:function(d){dateDiffs=new Array();today=new XDate();for(var c=0;c<d.length;c++){dateDiffs[c]=d[c].diffDays(today)}min=b.roundN(jStat.min(dateDiffs),0);max=b.roundN(jStat.max(dateDiffs),0);mean=b.roundN(jStat.mean(dateDiffs),0);median=b.roundN(jStat.median(dateDiffs),0);std=b.roundN(jStat.stdev(dateDiffs),0);if(b.cwSD==false){b.cwSts.mean=mean;b.cwSts.mstd=mean+std;$("#below").html("Less than "+b.cwSts.mean+" days old");$("#above").html(mean+" to "+b.cwSts.mstd+" days old");$("#outside").html("Greater than "+b.cwSts.mstd+" days old");b.cwSD=true}$("#statResults").fadeOut(function(){$("#statResults").html('<div class="well"><strong>'+b.commas(d.length)+"&nbsp;Open Requests<br><br>Statistics</strong> (days since request)<br><strong>"+min+"</strong> Minimum<br><strong>"+max+"</strong> Maximum<br><strong>"+median+"</strong> Median<br><strong>"+mean+"</strong> Average<br><strong>&plusmn;"+std+"</strong> Standard Deviation</div>")});$("#statResults").fadeIn()},roundN:function(d,e){var c=Math.round(d*Math.pow(10,e))/Math.pow(10,e);return c},aSrch:function(){b.addr=$("#address").val();if(b.addr!=""&&b.addr!=false){b.addr+=" Chicago IL";b.gcodr.geocode({address:b.addr},function(d,c){if(c==google.maps.GeocoderStatus.OK){if(b.aMkr!=false){b.aMkr.setMap(null)}b.cMkrs();a.setCenter(d[0].geometry.location);a.setZoom(15);b.aMkr=new google.maps.Marker({position:d[0].geometry.location,map:a,animation:google.maps.Animation.DROP});b.pDH(null)}else{alert("We could not locate your address: "+c)}})}else{if(b.aMkr!=false){b.aMkr.setMap(null);b.cMkrs();a.setCenter(b.mCtr);a.setZoom(11);b.pDH(b.pD);$("#address").val("")}}},cMkrs:function(){if(b.pMkrs.length>0){for(var c in b.pMkrs){b.pMkrs[c].setMap(null);b.pInf[c].setMap(null)}}}};var a=new google.maps.Map(b.mDOM,b.mOpt);a.setCenter(b.mCtr);$.get(b.pDURL,b.pDH,"jsonp");b.wLyr=new google.maps.FusionTablesLayer(b.wTID,{query:"SELECT "+b.wCol+" FROM "+b.wTID});$("#wards").click(function(){if($("#wards").is(":checked")){b.wLyr.setMap(a)}else{b.wLyr.setMap(null)}});$("#map-refresh").click(b.aSrch);$("#map-all").click(function(){if(b.aMkr!=false){b.aMkr.setMap(null);a.setCenter(b.mCtr);a.setZoom(11)}b.pDH(b.pD);$("#address").val("")});$("#toggle-more").click(function(c){$("#content-more").toggle("fast");$("#toggle-more").text(($("#toggle-more").text()=="Show more")?"Show less":"Show more")});$("#theForm").submit(function(){return false})});