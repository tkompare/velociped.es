//TkMap4.0.0.0.min.js
function TkMap(r){var n=typeof r.lat!=="undefined"?r.lat:null;var o=typeof r.lng!=="undefined"?r.lng:null;var a=typeof r.domid!=="undefined"?r.domid:null;var g=typeof r.zoom!=="undefined"?r.zoom:15;var f=typeof r.init!=="undefined"?r.init:false;var h=typeof r.responsive!=="undefined"?r.responsive:false;var d=typeof r.styles!=="undefined"?r.styles:null;var b={center:new google.maps.LatLng(n,o),draggable:true,mapTypeControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:false,streetViewControl:false,styles:[],zoom:g,zoomControl:true};var k=false;var j=null;var p=null;this.Map=null;var e=function(s){k=true;j=s.touches[0].pageY};var q=function(){k=false};var m=function(s){if(!k){return}p=s.touches[0].pageY;window.scrollBy(0,(j-p))};var l=function(){var s=d.split(" ");for(i in s){if(s[i]==="satellite"){b.mapTypeId=google.maps.MapTypeId.SATELLITE}else{if(s[i]==="hybrid"){b.mapTypeId=google.maps.MapTypeId.HYBRID}else{if(s[i]==="road"){b.mapTypeId=google.maps.MapTypeId.ROADMAP}else{if(s[i]==="terrain"){b.mapTypeId=google.maps.MapTypeId.TERRAIN}else{if(s[i]==="minlabels"){b.styles.push({featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]})}else{if(s[i]==="grey"){b.backgroundColor="#C5C5C5";b.styles.push({stylers:[{saturation:-99}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:85}]},{featureType:"water",stylers:[{lightness:-40}]})}}}}}}}};var c=function(){var s=$("#"+a).width();if(s<481){b.zoom--}else{if(s>959){b.zoom++}}};this.initMap=function(){if(this.Map===null){if(d!==null){l()}if(h){c()}this.Map=new google.maps.Map(document.getElementById(a),b)}};this.setMapOptions=function(s){if(this.Map!==null){$.extend(b,s)}};this.setTouchScroll=function(s){if(s){document.getElementById(a).addEventListener("touchstart",e,true);document.getElementById(a).addEventListener("touchend",q,true);document.getElementById(a).addEventListener("touchmove",m,true);this.Map.setOptions({zoomControl:false})}else{document.getElementById(a).removeEventListener("touchstart",e,true);document.getElementById(a).removeEventListener("touchend",q,true);document.getElementById(a).removeEventListener("touchmove",m,true);this.Map.setOptions({zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP}})}};this.setPanZoom=function(t){var s;if(t){s=false}else{s=true}this.Map.setOptions({disableDoubleClickZoom:s,draggable:t,keyboardShortcuts:t,scrollwheel:t,zoomControl:t})};if(f===true){this.initMap()}};
//TkSocrataView.1.0.0.min.js
function TkSocrataView(a){var f=typeof a.viewid!=="undefined"?a.viewid:null;var e=typeof a.domain!=="undefined"?a.domain:null;var c=null;var d=[];var b=function(p){var g=[];var n=p.meta.view.columns.length;for(var m=8;m<n;m++){var k=m-8;g[k]=p.meta.view.columns[m].fieldName}var o=g.length;var h=p.data;for(var m=0;m<h.length;m++){for(var k=0;k<8;k++){h[m].shift()}d[m]={};for(var k=0;k<o;k++){var l=g[k];d[m][l]=h[m][k]}}};if(f!==null||e!==null){c="http://"+e+"/api/views/"+f+"/rows.json?jsonp=?";$.get(c,b,"jsonp")}this.getData=function(){return d}};
//TkFusionLayer.3.0.0.min.js
function TkMapFusionLayer(b){var f=typeof b.map!=="undefined"?b.map:null;var e=typeof b.geo!=="undefined"?b.geo:null;var d=typeof b.tableid!=="undefined"?b.tableid:null;var g=typeof b.where!=="undefined"?b.where:null;var c=typeof b.icon!=="undefined"?b.icon:null;var a=typeof b.style!=="undefined"?b.style:null;this.Layer=null;this.showLayer=function(h){var i=typeof h.where!=="undefined"?h.where:g;var l=typeof h.icon!=="undefined"?h.icon:c;var k=typeof h.linestyle!=="undefined"?h.style:a;this.hideLayer();var j=null;if(i===null){j={select:e,from:d}}else{j={select:e,from:d,where:i}}if(l!==null){this.Layer=new google.maps.FusionTablesLayer({clickable:false,query:j,styles:[{markerOptions:{iconName:l}}]})}else{if(k!==null){this.Layer=new google.maps.FusionTablesLayer({clickable:false,query:j,styles:k})}else{this.Layer=new google.maps.FusionTablesLayer({clickable:false,query:j})}}this.Layer.setMap(f)};this.hideLayer=function(){if(this.Layer!==null){this.Layer.setMap(null)}};if(f!==null&&e!==null&&d!==null){this.showLayer({})}};
// Main.min.js
$(document).ready(function(){var c=0;var a=0;var s=new Array();var d=[];var v=[];var A={open:function(E,C,D){return function(){D.open(E,C)}},close:function(E,C,D){return function(){D.close(E,C)}}};var j=[];var x=[];var e={open:function(E,C,D){return function(){D.open(E,C)}},close:function(E,C,D){return function(){D.close(E,C)}}};var r=null;var f=null;var q=new google.maps.DirectionsService();var k=new TkMap({domid:"map",init:true,lat:41.882103,lng:-87.627793,responsive:true,styles:"grey"});var n=new google.maps.places.PlacesService(k.Map);var p={};if(Modernizr.touch){$("#maplock").prop("checked",false);k.setPanZoom(false);k.setTouchScroll(true)}else{$("#maplock").prop("checked",true);k.setPanZoom(true);k.setTouchScroll(false);p={draggable:true,suppressInfoWindows:true}}var i=new google.maps.DirectionsRenderer(p);i.setMap(k.Map);var g=new google.maps.BicyclingLayer();g.setMap(k.Map);var z=new TkMapFusionLayer({geo:"geometry",map:k.Map,tableid:"4329179",style:[{where:"description CONTAINS 'RECOMMENDED BIKE ROUTE'",polylineOptions:{strokeColor:"#55BB22",strokeWeight:"4",strokeOpacity:"0.75"}},{where:"description DOES NOT CONTAIN 'RECOMMENDED BIKE ROUTE'",polylineOptions:{strokeColor:"#004400",strokeWeight:"4",strokeOpacity:"0.75"}}]});var o=new TkSocrataView({viewid:"3jcw-ywxj",domain:"data.cityofchicago.org",});var w=document.getElementById("myTextDiv");k.Map.controls[google.maps.ControlPosition.RIGHT_TOP].push(w);$("#maplock").click(function(){if($("#maplock").is(":checked")){k.setPanZoom(true);k.setTouchScroll(false)}else{k.setPanZoom(false);k.setTouchScroll(true)}});$("#route").click(function(){if(f!==null){f.setMap(null)}if(d.length>0){for(var D in d){d[D].setMap(null)}}var F=$("#origin").val()+" Chicago, IL";var C=$("#destination").val()+" Chicago, IL";var E=[];if($("#stop1").val()!=""){E.push({location:$("#stop1").val()+", Chicago, IL",stopover:true})}if($("#stop2").val()!=""){E.push({location:$("#stop2").val()+", Chicago, IL",stopover:true})}var G=null;if($("#transit").is(":checked")==true){G={origin:F,destination:C,waypoints:E,optimizeWaypoints:true,travelMode:google.maps.TravelMode.TRANSIT}}else{G={origin:F,destination:C,waypoints:E,optimizeWaypoints:true,travelMode:google.maps.TravelMode.BICYCLING}}q.route(G,function(J,I){if(I==google.maps.DirectionsStatus.OK){for(var L in J.routes[0].legs){for(var H in J.routes[0].legs[L].steps){if(J.routes[0].legs[L].steps[H].travel_mode=="WALKING"){J.routes[0].legs[L].steps[H].travel_mode=""}}}i.setDirections(J);m();if($("#place").val().length>0){console.log($("#place").val());console.log(J.routes[0].bounds);var K={bounds:J.routes[0].bounds,query:$("#place").val()};n.textSearch(K,B)}}})});function h(E){var C=0;var D=0;c=0;a=0;s=new Array();for(var I in E.routes[0].legs){D++;var K=0;for(var H in E.routes[0].legs[I].steps){K++;var J=H;J++;var G=E.routes[0].legs[I].steps[H].distance.value/1609.334;G=Math.round(G*100)/100;C=C+E.routes[0].legs[I].steps[H].distance.value;s[a]=new Object();s[a].text=(a+1)+". "+E.routes[0].legs[I].steps[H].instructions+" (Go "+G+" miles)";s[a].text=s[a].text.replace(/walk/g,"bike");s[a].text=s[a].text.replace(/Walk/g,"Bike");if(E.routes[0].legs[I].steps[H].travel_mode=="TRANSIT"){s[a].text=s[a].text.replace(/Bus/g,"#"+E.routes[0].legs[I].steps[H].transit.line.short_name+" Bus");s[a].text=s[a].text.replace(/Subway/g,E.routes[0].legs[I].steps[H].transit.line.name)}s[a].latlng=E.routes[0].legs[I].steps[H].start_location;s[a].latlngEnd=E.routes[0].legs[I].steps[H].end_location;s[a].path=E.routes[0].legs[I].steps[H].path;a++}}var F=C/1609.344;F=Math.round(F*100)/100;$("#myTextDiv").html("<b>Total Distance: "+F+" miles.</b>");if($("#directions").hasClass("alert-error")){$("#directions").removeClass("alert-error");$("#directions").addClass("alert-info")}$("#directions-text").html("<b>Total Distance: "+F+" miles</b><br>Click above to step through your route.");if($(window).width()<769){$("#show-directions").text("Show Directions");$("#show-directions").removeClass("hide");$("#alert-directions").addClass("hide");$("#btn-dir").addClass("hide")}else{$("#show-directions").text("Hide Directions");$("#show-directions").removeClass("hide");$("#alert-directions").removeClass("hide");$("#btn-dir").removeClass("hide")}}google.maps.event.addListener(i,"directions_changed",function(){c=0;h(i.directions)});function B(E,C){m();if(C==google.maps.places.PlacesServiceStatus.OK){for(var D=0;D<E.length;D++){b(E[D],D)}}}function b(C,G){var H=C.formatted_address.split(",");j[G]=new google.maps.Marker({map:k.Map,position:C.geometry.location});var D="";var F=typeof C.opening_hours!=="undefined"?C.opening_hours.open_now:null;var E=null;if(F){D=" (Open)"}else{if(F===false){D=" (Closed)"}}E='<div id="placeinfobox'+G+'" class="placeInfoBox" style="border:3px solid rgb(0,128,128); margin-top:8px; background:rgb(247,247,247); padding:5px; font-size:85%;">'+C.name+D+"<br>"+H[0]+"</div>";console.log(E);InfoBoxOptions={content:E,disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-84,0),zIndex:10000,boxStyle:{background:"url('img/tipbox.gif') no-repeat",opacity:0.95,width:"160px"},closeBoxMargin:"13px 5px 5px 5px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};x[G]=new InfoBox(InfoBoxOptions);google.maps.event.addListener(j[G],"click",e.open(k.Map,j[G],x[G]))}function m(){if(j.length>0){for(var C in j){google.maps.event.clearInstanceListeners(j[C]);j[C].setMap(null)}j=[]}}$("#btn-dir-start").click(function(){c=0;r=new google.maps.LatLngBounds();r.extend(s[c].latlng);r.extend(s[c].latlngEnd);k.Map.fitBounds(r);if(f!==null){f.setMap(null)}f=new google.maps.Polyline({path:s[c].path,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5,zIndex:100000});f.setMap(k.Map);$("#directions-text").fadeOut(function(){$("#directions-text").html(s[c].text);if($("#directions").hasClass("alert-info")){$("#directions").removeClass("alert-info");$("#directions").addClass("alert-error")}$("#directions-text").fadeIn()});t(s[c].latlngEnd)});$("#btn-dir-back").click(function(){if(c>0){c--;r=new google.maps.LatLngBounds();r.extend(s[c].latlng);r.extend(s[c].latlngEnd);k.Map.fitBounds(r);if(f!==null){f.setMap(null)}f=new google.maps.Polyline({path:s[c].path,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5,zIndex:100000});f.setMap(k.Map)}$("#directions-text").fadeOut(function(){$("#directions-text").html(s[c].text);if($("#directions").hasClass("alert-info")){$("#directions").removeClass("alert-info");$("#directions").addClass("alert-error")}$("#directions-text").fadeIn()});t(s[c].latlngEnd)});$("#btn-dir-forward").click(function(){if(c<(s.length-1)){c++;r=new google.maps.LatLngBounds();r.extend(s[c].latlng);r.extend(s[c].latlngEnd);k.Map.fitBounds(r);if(f!==null){f.setMap(null)}f=new google.maps.Polyline({path:s[c].path,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5,zIndex:100000});f.setMap(k.Map)}$("#directions-text").fadeOut(function(){$("#directions-text").html(s[c].text);if($("#directions").hasClass("alert-info")){$("#directions").removeClass("alert-info");$("#directions").addClass("alert-error")}$("#directions-text").fadeIn()});t(s[c].latlngEnd)});$("#btn-dir-end").click(function(){c=s.length-1;r=new google.maps.LatLngBounds();r.extend(s[c].latlng);r.extend(s[c].latlngEnd);k.Map.fitBounds(r);if(f!==null){f.setMap(null)}f=new google.maps.Polyline({path:s[c].path,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:5,zIndex:100000});f.setMap(k.Map);$("#directions-text").fadeOut(function(){$("#directions-text").html(s[c].text);if($("#directions").hasClass("alert-info")){$("#directions").removeClass("alert-info");$("#directions").addClass("alert-error")}$("#directions-text").fadeIn()});t(s[c].latlngEnd)});$("#show-directions").click(function(){if($("#alert-directions").hasClass("hide")){$("#show-directions").text("Hide Directions");$("#alert-directions").removeClass("hide")}else{$("#show-directions").text("Show Directions");$("#alert-directions").addClass("hide")}if($("#btn-dir").hasClass("hide")){$("#btn-dir").removeClass("hide")}else{$("#btn-dir").addClass("hide")}});$("#btn-more").click(function(){if($("#div-more").hasClass("hide")){$("#btn-more").text("Less");$("#div-more").removeClass("hide")}else{$("#btn-more").text("More");$("#div-more").addClass("hide")}});$("#btn-help").click(function(){if($("#div-help").hasClass("hide")){$("#btn-help").text("Close Help");$("#div-help").removeClass("hide")}else{$("#btn-help").text("Help");$("#div-help").addClass("hide")}});$("#btn-close-help").click(function(){$("#btn-help").text("Help");$("#div-help").addClass("hide")});$("#btn-stop1").click(function(){$("#stop1").val("")});$("#btn-stop2").click(function(){$("#stop2").val("")});$("#btn-place").click(function(){$("#place").val("")});$("#origin, #stop1, #stop2, #destination").change(function(){google.maps.event.clearListeners(k.Map,"click")});$("#btn-origin").click(function(){if($("#maplock").is(":checked")){u(true,"origin")}else{u(false,"origin")}});$("#btn-stop1").click(function(){if($("#maplock").is(":checked")){u(true,"stop1")}else{u(false,"stop1")}});$("#btn-stop2").click(function(){if($("#maplock").is(":checked")){u(true,"stop2")}else{u(false,"stop2")}});$("#btn-destination").click(function(){if($("#maplock").is(":checked")){u(true,"destination")}else{u(false,"destination")}});function u(D,C){google.maps.event.clearListeners(k.Map,"click");if(D){google.maps.event.addListenerOnce(k.Map,"click",function(E){var F=new google.maps.LatLng(E.latLng.lat(),E.latLng.lng());l(F,C)})}else{k.setTouchScroll(false);k.setPanZoom(true);$("#maplock").prop("checked",true);google.maps.event.addListenerOnce(k.Map,"click",function(E){var F=new google.maps.LatLng(E.latLng.lat(),E.latLng.lng());l(F,C)})}}$("#gps").click(function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(C){var D=new google.maps.LatLng(C.coords.latitude,C.coords.longitude);k.Map.setCenter(D);l(D,"origin")},function(){y(true)})}else{y(false)}});function y(C){if(C){$("#gpsfail").text("Error: The Geolocation service failed.");$("#alert-gpsfail").removeClass("hide")}else{$("#gpsfail").text("Error: Your browser doesn't support geolocation.");$("#alert-gpsfail").removeClass("hide")}}function l(D,C){geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:D},function(F,E){if(E==google.maps.GeocoderStatus.OK){if(F[1]){$("#"+C).val(F[0].address_components[0].long_name+" "+F[0].address_components[1].long_name)}else{alert("No results found")}}else{alert("Geocoder failed due to: "+E)}})}function t(G){if(d.length>0){for(var D in d){google.maps.event.clearInstanceListeners(d[D]);d[D].setMap(null)}for(var D in v){v[D].close()}v=[];d=[]}var C=o.getData();var H=[];var F=0;for(var D in C){if(C[D].latitude<G.lat()+0.0019&&C[D].latitude>G.lat()-0.0019&&C[D].longitude<G.lng()+0.00245&&C[D].longitude>G.lng()-0.00245){H[F]=new google.maps.LatLng(C[D].latitude,C[D].longitude);d[F]=new google.maps.Marker({position:H[F],map:k.Map,icon:"img/bikelock20.png"});var E='<div id="infobox'+F+'" class="infoBox" style="border:3px solid rgb(0,0,0); margin-top:8px; background:rgb(247,247,247); padding:5px; font-size:85%;">'+C[D].address+"<br>Number of Racks: "+Math.round(C[D].totinstall)+"</div>";InfoBoxOptions={content:E,disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-84,0),zIndex:10000,boxStyle:{background:"url('img/tipbox.gif') no-repeat",opacity:0.95,width:"160px"},closeBoxMargin:"13px 5px 5px 5px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};v[F]=new InfoBox(InfoBoxOptions);r.extend(H[F]);k.Map.fitBounds(r);google.maps.event.addListener(d[F],"click",A.open(k.Map,d[F],v[F]));F++}}}});