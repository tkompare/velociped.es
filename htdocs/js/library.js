//TkMap4.0.0.0.min.js
function TkMap(r){var n=typeof r.lat!=="undefined"?r.lat:null;var o=typeof r.lng!=="undefined"?r.lng:null;var a=typeof r.domid!=="undefined"?r.domid:null;var g=typeof r.zoom!=="undefined"?r.zoom:15;var f=typeof r.init!=="undefined"?r.init:false;var h=typeof r.responsive!=="undefined"?r.responsive:false;var d=typeof r.styles!=="undefined"?r.styles:null;var b={center:new google.maps.LatLng(n,o),draggable:true,mapTypeControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:false,streetViewControl:false,styles:[],zoom:g,zoomControl:true};var k=false;var j=null;var p=null;this.Map=null;var e=function(s){k=true;j=s.touches[0].pageY};var q=function(){k=false};var m=function(s){if(!k){return}p=s.touches[0].pageY;window.scrollBy(0,(j-p))};var l=function(){var s=d.split(" ");for(i in s){if(s[i]==="satellite"){b.mapTypeId=google.maps.MapTypeId.SATELLITE}else{if(s[i]==="hybrid"){b.mapTypeId=google.maps.MapTypeId.HYBRID}else{if(s[i]==="road"){b.mapTypeId=google.maps.MapTypeId.ROADMAP}else{if(s[i]==="terrain"){b.mapTypeId=google.maps.MapTypeId.TERRAIN}else{if(s[i]==="minlabels"){b.styles.push({featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]})}else{if(s[i]==="grey"){b.backgroundColor="#C5C5C5";b.styles.push({stylers:[{saturation:-99}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:85}]},{featureType:"water",stylers:[{lightness:-40}]})}}}}}}}};var c=function(){var s=$("#"+a).width();if(s<481){b.zoom--}else{if(s>959){b.zoom++}}};this.initMap=function(){if(this.Map===null){if(d!==null){l()}if(h){c()}this.Map=new google.maps.Map(document.getElementById(a),b)}};this.setMapOptions=function(s){if(this.Map!==null){$.extend(b,s)}};this.setTouchScroll=function(s){if(s){document.getElementById(a).addEventListener("touchstart",e,true);document.getElementById(a).addEventListener("touchend",q,true);document.getElementById(a).addEventListener("touchmove",m,true);this.Map.setOptions({zoomControl:false})}else{document.getElementById(a).removeEventListener("touchstart",e,true);document.getElementById(a).removeEventListener("touchend",q,true);document.getElementById(a).removeEventListener("touchmove",m,true);this.Map.setOptions({zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP}})}};this.setPanZoom=function(t){var s;if(t){s=false}else{s=true}this.Map.setOptions({disableDoubleClickZoom:s,draggable:t,keyboardShortcuts:t,scrollwheel:t,zoomControl:t})};if(f===true){this.initMap()}};
//TkSocrataView.1.0.0.min.js
function TkSocrataView(a){var f=typeof a.viewid!=="undefined"?a.viewid:null;var e=typeof a.domain!=="undefined"?a.domain:null;var c=null;var d=[];var b=function(p){var g=[];var n=p.meta.view.columns.length;for(var m=8;m<n;m++){var k=m-8;g[k]=p.meta.view.columns[m].fieldName}var o=g.length;var h=p.data;for(var m=0;m<h.length;m++){for(var k=0;k<8;k++){h[m].shift()}d[m]={};for(var k=0;k<o;k++){var l=g[k];d[m][l]=h[m][k]}}};if(f!==null||e!==null){c="http://"+e+"/api/views/"+f+"/rows.json?jsonp=?";$.get(c,b,"jsonp")}this.getData=function(){return d}};
//TkFusionLayer.3.0.0.min.js
function TkMapFusionLayer(b){var f=typeof b.map!=="undefined"?b.map:null;var e=typeof b.geo!=="undefined"?b.geo:null;var d=typeof b.tableid!=="undefined"?b.tableid:null;var g=typeof b.where!=="undefined"?b.where:null;var c=typeof b.icon!=="undefined"?b.icon:null;var a=typeof b.style!=="undefined"?b.style:null;this.Layer=null;this.showLayer=function(h){var i=typeof h.where!=="undefined"?h.where:g;var l=typeof h.icon!=="undefined"?h.icon:c;var k=typeof h.linestyle!=="undefined"?h.style:a;this.hideLayer();var j=null;if(i===null){j={select:e,from:d}}else{j={select:e,from:d,where:i}}if(l!==null){this.Layer=new google.maps.FusionTablesLayer({clickable:false,query:j,styles:[{markerOptions:{iconName:l}}]})}else{if(k!==null){this.Layer=new google.maps.FusionTablesLayer({clickable:false,query:j,styles:k})}else{this.Layer=new google.maps.FusionTablesLayer({clickable:false,query:j})}}this.Layer.setMap(f)};this.hideLayer=function(){if(this.Layer!==null){this.Layer.setMap(null)}};if(f!==null&&e!==null&&d!==null){this.showLayer({})}};
// Main.min.js
$(document).ready(function(){var d=0;var b=0;var u=new Array();var e=[];var w=[];var B={open:function(F,D,E){return function(){E.open(F,D)}},close:function(F,D,E){return function(){E.close(F,D)}}};var k=[];var y=[];var f={open:function(F,D,E){return function(){E.open(F,D)}},close:function(F,D,E){return function(){E.close(F,D)}}};var t=null;var g=null;var s=new google.maps.DirectionsService();var l=new TkMap({domid:"map",init:true,lat:41.882103,lng:-87.627793,responsive:true,styles:"grey"});var o=new google.maps.places.PlacesService(l.Map);var r={};if(Modernizr.touch){$("#maplock").prop("checked",false);l.setPanZoom(false);l.setTouchScroll(true)}else{$("#maplock").prop("checked",true);l.setPanZoom(true);l.setTouchScroll(false);r={draggable:true,suppressInfoWindows:true,polylineOptions:{strokeColor:"#0954cf",strokeWeight:"4",strokeOpacity:"0.85"}}}var j=new google.maps.DirectionsRenderer(r);j.setMap(l.Map);var h=new google.maps.BicyclingLayer();h.setMap(l.Map);var A=new TkMapFusionLayer({geo:"geometry",map:l.Map,tableid:"4329179",style:[{where:"description CONTAINS 'RECOMMENDED BIKE ROUTE'",polylineOptions:{strokeColor:"#449911",strokeWeight:"4",strokeOpacity:"0.50"}},{where:"description DOES NOT CONTAIN 'RECOMMENDED BIKE ROUTE'",polylineOptions:{strokeColor:"#002200",strokeWeight:"4",strokeOpacity:"0.50"}}]});var q=new TkSocrataView({viewid:"3jcw-ywxj",domain:"data.cityofchicago.org",});var x=document.getElementById("myTextDiv");l.Map.controls[google.maps.ControlPosition.RIGHT_TOP].push(x);$("#maplock").click(function(){if($("#maplock").is(":checked")){l.setPanZoom(true);l.setTouchScroll(false)}else{l.setPanZoom(false);l.setTouchScroll(true)}});$("#route").click(function(){if(g!==null){g.setMap(null)}if(e.length>0){for(var E in e){e[E].setMap(null)}}var G=$("#origin").val()+" Chicago, IL";var D=$("#destination").val()+" Chicago, IL";var F=[];if($("#stop1").val()!=""){F.push({location:$("#stop1").val()+", Chicago, IL",stopover:true})}if($("#stop2").val()!=""){F.push({location:$("#stop2").val()+", Chicago, IL",stopover:true})}var H=null;if($("#transit").is(":checked")==true){H={origin:G,destination:D,waypoints:F,optimizeWaypoints:true,travelMode:google.maps.TravelMode.TRANSIT}}else{H={origin:G,destination:D,waypoints:F,optimizeWaypoints:true,travelMode:google.maps.TravelMode.BICYCLING}}s.route(H,function(K,J){if(J==google.maps.DirectionsStatus.OK){for(var M in K.routes[0].legs){for(var I in K.routes[0].legs[M].steps){if(K.routes[0].legs[M].steps[I].travel_mode=="WALKING"){K.routes[0].legs[M].steps[I].travel_mode=""}}}j.setDirections(K);n();if($("#place").val().length>0){console.log($("#place").val());console.log(K.routes[0].bounds);var L={bounds:K.routes[0].bounds,query:$("#place").val()};o.textSearch(L,C)}}})});function i(F){var D=0;var E=0;d=0;b=0;u=new Array();for(var J in F.routes[0].legs){E++;var L=0;$("#modal-btn").removeClass("hide");$("#modal-body").text("");for(var I in F.routes[0].legs[J].steps){L++;var K=I;K++;var H=F.routes[0].legs[J].steps[I].distance.value/1609.334;H=Math.round(H*100)/100;D=D+F.routes[0].legs[J].steps[I].distance.value;u[b]=new Object();u[b].text=(b+1)+". "+F.routes[0].legs[J].steps[I].instructions+" (Go "+H+" miles)";u[b].text=u[b].text.replace(/walk/g,"bike");u[b].text=u[b].text.replace(/Walk/g,"Bike");if(F.routes[0].legs[J].steps[I].travel_mode=="TRANSIT"){u[b].text=u[b].text.replace(/Bus/g,"#"+F.routes[0].legs[J].steps[I].transit.line.short_name+" Bus");u[b].text=u[b].text.replace(/Subway/g,F.routes[0].legs[J].steps[I].transit.line.name)}u[b].latlng=F.routes[0].legs[J].steps[I].start_location;u[b].latlngEnd=F.routes[0].legs[J].steps[I].end_location;u[b].path=F.routes[0].legs[J].steps[I].path;$("#modal-body").append("<p>"+u[b].text+"</p>");b++}}var G=D/1609.344;G=Math.round(G*100)/100;$("#myTextDiv").html("<b>Total Distance: "+G+" miles.</b>");if($("#directions-text").hasClass("red")){$("#directions-text").removeClass("red");$("#directions-text").addClass("blue")}$("#directions-text").html("<b>Total Distance: "+G+" miles</b><br>Click above to step through your route.");if($(window).width()<769){$("#show-directions").text("Show Directions");$("#show-directions").removeClass("hide");$("#alert-directions").addClass("hide");$("#btn-dir").addClass("hide")}else{$("#show-directions").text("Hide Directions");$("#show-directions").removeClass("hide");$("#alert-directions").removeClass("hide");$("#btn-dir").removeClass("hide")}}google.maps.event.addListener(j,"directions_changed",function(){d=0;i(j.directions)});function C(F,D){n();if(D==google.maps.places.PlacesServiceStatus.OK){for(var E=0;E<F.length;E++){c(F[E],E)}}}function c(D,H){var I=D.formatted_address.split(",");k[H]=new google.maps.Marker({map:l.Map,position:D.geometry.location});var E="";var G=typeof D.opening_hours!=="undefined"?D.opening_hours.open_now:null;var F=null;if(G){E=" (Open)"}else{if(G===false){E=" (Closed)"}}F='<div id="placeinfobox'+H+'" class="placeInfoBox" style="border:3px solid rgb(0,128,128); margin-top:8px; background:rgb(247,247,247); padding:5px; font-size:85%;">'+D.name+E+"<br>"+I[0]+"</div>";console.log(F);InfoBoxOptions={content:F,disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-84,0),zIndex:10000,boxStyle:{background:"url('img/tipbox.gif') no-repeat",opacity:0.95,width:"160px"},closeBoxMargin:"13px 5px 5px 5px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};y[H]=new InfoBox(InfoBoxOptions);google.maps.event.addListener(k[H],"click",f.open(l.Map,k[H],y[H]))}function n(){if(k.length>0){for(var D in k){google.maps.event.clearInstanceListeners(k[D]);k[D].setMap(null)}k=[]}}$("#btn-dir-start").click(function(){d=0;a();p();v(u[d].latlngEnd)});$("#btn-dir-back").click(function(){if(d>0){d--;a()}p();v(u[d].latlngEnd)});$("#btn-dir-forward").click(function(){if(d<(u.length-1)){d++;a()}p();v(u[d].latlngEnd)});$("#btn-dir-end").click(function(){d=u.length-1;a();p();v(u[d].latlngEnd)});function a(){t=new google.maps.LatLngBounds();t.extend(u[d].latlng);t.extend(u[d].latlngEnd);l.Map.fitBounds(t);if(g!==null){g.setMap(null)}g=new google.maps.Polyline({path:u[d].path,strokeColor:"#ca4a48",strokeOpacity:"0.85",strokeWeight:"5",zIndex:"100000"});g.setMap(l.Map)}function p(){$("#directions-text").fadeOut(function(){$("#directions-text").html(u[d].text);if($("#directions-text").hasClass("blue")){$("#directions-text").removeClass("blue");$("#directions-text").addClass("red")}$("#directions-text").fadeIn()})}$("#show-directions").click(function(){if($("#alert-directions").hasClass("hide")){$("#show-directions").text("Hide Directions");$("#alert-directions").removeClass("hide")}else{$("#show-directions").text("Show Directions");$("#alert-directions").addClass("hide")}if($("#btn-dir").hasClass("hide")){$("#btn-dir").removeClass("hide")}else{$("#btn-dir").addClass("hide")}});$("#btn-more").click(function(){if($("#div-more").hasClass("hide")){$("#btn-more").text("Less");$("#div-more").removeClass("hide")}else{$("#btn-more").text("More");$("#div-more").addClass("hide")}});$("#btn-help").click(function(){if($("#div-help").hasClass("hide")){$("#btn-help").text("Close Help");$("#div-help").removeClass("hide")}else{$("#btn-help").text("Help");$("#div-help").addClass("hide")}});$("#btn-close-help").click(function(){$("#btn-help").text("Help");$("#div-help").addClass("hide")});$(".btn-clr").click(function(){if(D!="place"){google.maps.event.clearListeners(l.Map,"click")}var D=$(this).attr("id").split("-")[2];$("#"+D).val("")});$("#origin, #stop1, #stop2, #destination").change(function(){google.maps.event.clearListeners(l.Map,"click")});$(".btn-map").click(function(){google.maps.event.clearListeners(l.Map,"click");var D=$(this).attr("id").split("-")[2];if(!$("#maplock").is(":checked")){l.setTouchScroll(false);l.setPanZoom(true);$("#maplock").prop("checked",true)}google.maps.event.addListenerOnce(l.Map,"click",function(E){var F=new google.maps.LatLng(E.latLng.lat(),E.latLng.lng());m(F,D)})});$("#btn-map-labels").click(function(){console.log("here!");l.Map.setOptions({featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]})});$("#gps").click(function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(D){var E=new google.maps.LatLng(D.coords.latitude,D.coords.longitude);l.Map.setCenter(E);m(E,"origin")},function(){z(true)})}else{z(false)}});function z(D){if(D){$("#gpsfail").text("Error: The Geolocation service failed.");$("#alert-gpsfail").removeClass("hide")}else{$("#gpsfail").text("Error: Your browser doesn't support geolocation.");$("#alert-gpsfail").removeClass("hide")}}function m(E,D){geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:E},function(G,F){if(F==google.maps.GeocoderStatus.OK){if(G[1]){$("#"+D).val(G[0].address_components[0].long_name+" "+G[0].address_components[1].long_name)}else{alert("No results found")}}else{alert("Geocoder failed due to: "+F)}})}function v(H){if(e.length>0){for(var E in e){google.maps.event.clearInstanceListeners(e[E]);e[E].setMap(null)}for(var E in w){w[E].close()}w=[];e=[]}var D=q.getData();var I=[];var G=0;for(var E in D){if(D[E].latitude<H.lat()+0.0019&&D[E].latitude>H.lat()-0.0019&&D[E].longitude<H.lng()+0.00245&&D[E].longitude>H.lng()-0.00245){I[G]=new google.maps.LatLng(D[E].latitude,D[E].longitude);e[G]=new google.maps.Marker({position:I[G],map:l.Map,icon:"img/bikelock20.png"});var F='<div id="infobox'+G+'" class="infoBox" style="border:3px solid rgb(0,0,0); margin-top:8px; background:rgb(247,247,247); padding:5px; font-size:85%;">'+D[E].address+"<br>Number of Racks: "+Math.round(D[E].totinstall)+"</div>";InfoBoxOptions={content:F,disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-84,0),zIndex:10000,boxStyle:{background:"url('img/tipbox.gif') no-repeat",opacity:0.95,width:"160px"},closeBoxMargin:"13px 5px 5px 5px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};w[G]=new InfoBox(InfoBoxOptions);t.extend(I[G]);l.Map.fitBounds(t);google.maps.event.addListener(e[G],"click",B.open(l.Map,e[G],w[G]));G++}}}});